const puppeteer = require('puppeteer')

function delay(time) {
  return new Promise(function (resolve) {
    setTimeout(resolve, time)
  });
}

const urls = [
  "https://datenbrowser.inek.org/DRG202210?q=eyJhZ2VHcm91cCI6IFtdLCJkZXB0IjogW10sImRyZyI6IFtdLCJmdXJ0aGVyUHJvY2VkdXJlIjogW10sImZ1cnRoZXJTZWNvbmRhcnlEaWFnbm9zaXMiOiBbXSwibWFpbkRpYWdub3NpcyI6IFtdLCJwcm9jZWR1cmUiOiBbXSwic2Vjb25kYXJ5RGlhZ25vc2lzIjogW10sImJlZENsYXNzIjogW10sImxvc0dyb3VwIjogW10sImRpc2NoYXJnZUZyb20iOiAiMjAyMi0wNi0wNlQwNjowMDowMC4wMDBaIiwiZGlzY2hhcmdlVG8iOiAiMjAyMi0wNi0xMlQwNjowMDowMC4wMDBaIn0%3D",
  "https://datenbrowser.inek.org/DRG202210?q=eyJhZ2VHcm91cCI6IFtdLCJkZXB0IjogW10sImRyZyI6IFtdLCJmdXJ0aGVyUHJvY2VkdXJlIjogW10sImZ1cnRoZXJTZWNvbmRhcnlEaWFnbm9zaXMiOiBbXSwibWFpbkRpYWdub3NpcyI6IFtdLCJwcm9jZWR1cmUiOiBbXSwic2Vjb25kYXJ5RGlhZ25vc2lzIjogW10sImJlZENsYXNzIjogW10sImxvc0dyb3VwIjogW10sImRpc2NoYXJnZUZyb20iOiAiMjAyMi0wNi0xM1QwNjowMDowMC4wMDBaIiwiZGlzY2hhcmdlVG8iOiAiMjAyMi0wNi0xOVQwNjowMDowMC4wMDBaIn0%3D",
  "https://datenbrowser.inek.org/DRG202210?q=eyJhZ2VHcm91cCI6IFtdLCJkZXB0IjogW10sImRyZyI6IFtdLCJmdXJ0aGVyUHJvY2VkdXJlIjogW10sImZ1cnRoZXJTZWNvbmRhcnlEaWFnbm9zaXMiOiBbXSwibWFpbkRpYWdub3NpcyI6IFtdLCJwcm9jZWR1cmUiOiBbXSwic2Vjb25kYXJ5RGlhZ25vc2lzIjogW10sImJlZENsYXNzIjogW10sImxvc0dyb3VwIjogW10sImRpc2NoYXJnZUZyb20iOiAiMjAyMi0wNi0yMFQwNjowMDowMC4wMDBaIiwiZGlzY2hhcmdlVG8iOiAiMjAyMi0wNi0yNlQwNjowMDowMC4wMDBaIn0%3D",
  "https://datenbrowser.inek.org/DRG202210?q=eyJhZ2VHcm91cCI6IFtdLCJkZXB0IjogW10sImRyZyI6IFtdLCJmdXJ0aGVyUHJvY2VkdXJlIjogW10sImZ1cnRoZXJTZWNvbmRhcnlEaWFnbm9zaXMiOiBbXSwibWFpbkRpYWdub3NpcyI6IFtdLCJwcm9jZWR1cmUiOiBbXSwic2Vjb25kYXJ5RGlhZ25vc2lzIjogW10sImJlZENsYXNzIjogW10sImxvc0dyb3VwIjogW10sImRpc2NoYXJnZUZyb20iOiAiMjAyMi0wNi0yN1QwNjowMDowMC4wMDBaIiwiZGlzY2hhcmdlVG8iOiAiMjAyMi0wNy0wM1QwNjowMDowMC4wMDBaIn0%3D",
  "https://datenbrowser.inek.org/DRG202210?q=eyJhZ2VHcm91cCI6IFtdLCJkZXB0IjogW10sImRyZyI6IFtdLCJmdXJ0aGVyUHJvY2VkdXJlIjogW10sImZ1cnRoZXJTZWNvbmRhcnlEaWFnbm9zaXMiOiBbXSwibWFpbkRpYWdub3NpcyI6IFtdLCJwcm9jZWR1cmUiOiBbXSwic2Vjb25kYXJ5RGlhZ25vc2lzIjogW10sImJlZENsYXNzIjogW10sImxvc0dyb3VwIjogW10sImRpc2NoYXJnZUZyb20iOiAiMjAyMi0wNy0wNFQwNjowMDowMC4wMDBaIiwiZGlzY2hhcmdlVG8iOiAiMjAyMi0wNy0xMFQwNjowMDowMC4wMDBaIn0%3D",
  "https://datenbrowser.inek.org/DRG202210?q=eyJhZ2VHcm91cCI6IFtdLCJkZXB0IjogW10sImRyZyI6IFtdLCJmdXJ0aGVyUHJvY2VkdXJlIjogW10sImZ1cnRoZXJTZWNvbmRhcnlEaWFnbm9zaXMiOiBbXSwibWFpbkRpYWdub3NpcyI6IFtdLCJwcm9jZWR1cmUiOiBbXSwic2Vjb25kYXJ5RGlhZ25vc2lzIjogW10sImJlZENsYXNzIjogW10sImxvc0dyb3VwIjogW10sImRpc2NoYXJnZUZyb20iOiAiMjAyMi0wNy0xMVQwNjowMDowMC4wMDBaIiwiZGlzY2hhcmdlVG8iOiAiMjAyMi0wNy0xN1QwNjowMDowMC4wMDBaIn0%3D",
  "https://datenbrowser.inek.org/DRG202210?q=eyJhZ2VHcm91cCI6IFtdLCJkZXB0IjogW10sImRyZyI6IFtdLCJmdXJ0aGVyUHJvY2VkdXJlIjogW10sImZ1cnRoZXJTZWNvbmRhcnlEaWFnbm9zaXMiOiBbXSwibWFpbkRpYWdub3NpcyI6IFtdLCJwcm9jZWR1cmUiOiBbXSwic2Vjb25kYXJ5RGlhZ25vc2lzIjogW10sImJlZENsYXNzIjogW10sImxvc0dyb3VwIjogW10sImRpc2NoYXJnZUZyb20iOiAiMjAyMi0wNy0xOFQwNjowMDowMC4wMDBaIiwiZGlzY2hhcmdlVG8iOiAiMjAyMi0wNy0yNFQwNjowMDowMC4wMDBaIn0%3D",
  "https://datenbrowser.inek.org/DRG202210?q=eyJhZ2VHcm91cCI6IFtdLCJkZXB0IjogW10sImRyZyI6IFtdLCJmdXJ0aGVyUHJvY2VkdXJlIjogW10sImZ1cnRoZXJTZWNvbmRhcnlEaWFnbm9zaXMiOiBbXSwibWFpbkRpYWdub3NpcyI6IFtdLCJwcm9jZWR1cmUiOiBbXSwic2Vjb25kYXJ5RGlhZ25vc2lzIjogW10sImJlZENsYXNzIjogW10sImxvc0dyb3VwIjogW10sImRpc2NoYXJnZUZyb20iOiAiMjAyMi0wNy0yNVQwNjowMDowMC4wMDBaIiwiZGlzY2hhcmdlVG8iOiAiMjAyMi0wNy0zMVQwNjowMDowMC4wMDBaIn0%3D",
  "https://datenbrowser.inek.org/DRG202210?q=eyJhZ2VHcm91cCI6IFtdLCJkZXB0IjogW10sImRyZyI6IFtdLCJmdXJ0aGVyUHJvY2VkdXJlIjogW10sImZ1cnRoZXJTZWNvbmRhcnlEaWFnbm9zaXMiOiBbXSwibWFpbkRpYWdub3NpcyI6IFtdLCJwcm9jZWR1cmUiOiBbXSwic2Vjb25kYXJ5RGlhZ25vc2lzIjogW10sImJlZENsYXNzIjogW10sImxvc0dyb3VwIjogW10sImRpc2NoYXJnZUZyb20iOiAiMjAyMi0wOC0wMVQwNjowMDowMC4wMDBaIiwiZGlzY2hhcmdlVG8iOiAiMjAyMi0wOC0wN1QwNjowMDowMC4wMDBaIn0%3D",
  "https://datenbrowser.inek.org/DRG202210?q=eyJhZ2VHcm91cCI6IFtdLCJkZXB0IjogW10sImRyZyI6IFtdLCJmdXJ0aGVyUHJvY2VkdXJlIjogW10sImZ1cnRoZXJTZWNvbmRhcnlEaWFnbm9zaXMiOiBbXSwibWFpbkRpYWdub3NpcyI6IFtdLCJwcm9jZWR1cmUiOiBbXSwic2Vjb25kYXJ5RGlhZ25vc2lzIjogW10sImJlZENsYXNzIjogW10sImxvc0dyb3VwIjogW10sImRpc2NoYXJnZUZyb20iOiAiMjAyMi0wOC0wOFQwNjowMDowMC4wMDBaIiwiZGlzY2hhcmdlVG8iOiAiMjAyMi0wOC0xNFQwNjowMDowMC4wMDBaIn0%3D",
  "https://datenbrowser.inek.org/DRG202210?q=eyJhZ2VHcm91cCI6IFtdLCJkZXB0IjogW10sImRyZyI6IFtdLCJmdXJ0aGVyUHJvY2VkdXJlIjogW10sImZ1cnRoZXJTZWNvbmRhcnlEaWFnbm9zaXMiOiBbXSwibWFpbkRpYWdub3NpcyI6IFtdLCJwcm9jZWR1cmUiOiBbXSwic2Vjb25kYXJ5RGlhZ25vc2lzIjogW10sImJlZENsYXNzIjogW10sImxvc0dyb3VwIjogW10sImRpc2NoYXJnZUZyb20iOiAiMjAyMi0wOC0xNVQwNjowMDowMC4wMDBaIiwiZGlzY2hhcmdlVG8iOiAiMjAyMi0wOC0yMVQwNjowMDowMC4wMDBaIn0%3D",
  "https://datenbrowser.inek.org/DRG202210?q=eyJhZ2VHcm91cCI6IFtdLCJkZXB0IjogW10sImRyZyI6IFtdLCJmdXJ0aGVyUHJvY2VkdXJlIjogW10sImZ1cnRoZXJTZWNvbmRhcnlEaWFnbm9zaXMiOiBbXSwibWFpbkRpYWdub3NpcyI6IFtdLCJwcm9jZWR1cmUiOiBbXSwic2Vjb25kYXJ5RGlhZ25vc2lzIjogW10sImJlZENsYXNzIjogW10sImxvc0dyb3VwIjogW10sImRpc2NoYXJnZUZyb20iOiAiMjAyMi0wOC0yMlQwNjowMDowMC4wMDBaIiwiZGlzY2hhcmdlVG8iOiAiMjAyMi0wOC0yOFQwNjowMDowMC4wMDBaIn0%3D",
  "https://datenbrowser.inek.org/DRG202210?q=eyJhZ2VHcm91cCI6IFtdLCJkZXB0IjogW10sImRyZyI6IFtdLCJmdXJ0aGVyUHJvY2VkdXJlIjogW10sImZ1cnRoZXJTZWNvbmRhcnlEaWFnbm9zaXMiOiBbXSwibWFpbkRpYWdub3NpcyI6IFtdLCJwcm9jZWR1cmUiOiBbXSwic2Vjb25kYXJ5RGlhZ25vc2lzIjogW10sImJlZENsYXNzIjogW10sImxvc0dyb3VwIjogW10sImRpc2NoYXJnZUZyb20iOiAiMjAyMi0wOC0yOVQwNjowMDowMC4wMDBaIiwiZGlzY2hhcmdlVG8iOiAiMjAyMi0wOS0wNFQwNjowMDowMC4wMDBaIn0%3D",
  "https://datenbrowser.inek.org/DRG202210?q=eyJhZ2VHcm91cCI6IFtdLCJkZXB0IjogW10sImRyZyI6IFtdLCJmdXJ0aGVyUHJvY2VkdXJlIjogW10sImZ1cnRoZXJTZWNvbmRhcnlEaWFnbm9zaXMiOiBbXSwibWFpbkRpYWdub3NpcyI6IFtdLCJwcm9jZWR1cmUiOiBbXSwic2Vjb25kYXJ5RGlhZ25vc2lzIjogW10sImJlZENsYXNzIjogW10sImxvc0dyb3VwIjogW10sImRpc2NoYXJnZUZyb20iOiAiMjAyMi0wOS0wNVQwNjowMDowMC4wMDBaIiwiZGlzY2hhcmdlVG8iOiAiMjAyMi0wOS0xMVQwNjowMDowMC4wMDBaIn0%3D",
  "https://datenbrowser.inek.org/DRG202210?q=eyJhZ2VHcm91cCI6IFtdLCJkZXB0IjogW10sImRyZyI6IFtdLCJmdXJ0aGVyUHJvY2VkdXJlIjogW10sImZ1cnRoZXJTZWNvbmRhcnlEaWFnbm9zaXMiOiBbXSwibWFpbkRpYWdub3NpcyI6IFtdLCJwcm9jZWR1cmUiOiBbXSwic2Vjb25kYXJ5RGlhZ25vc2lzIjogW10sImJlZENsYXNzIjogW10sImxvc0dyb3VwIjogW10sImRpc2NoYXJnZUZyb20iOiAiMjAyMi0wOS0xMlQwNjowMDowMC4wMDBaIiwiZGlzY2hhcmdlVG8iOiAiMjAyMi0wOS0xOFQwNjowMDowMC4wMDBaIn0%3D",
  "https://datenbrowser.inek.org/DRG202210?q=eyJhZ2VHcm91cCI6IFtdLCJkZXB0IjogW10sImRyZyI6IFtdLCJmdXJ0aGVyUHJvY2VkdXJlIjogW10sImZ1cnRoZXJTZWNvbmRhcnlEaWFnbm9zaXMiOiBbXSwibWFpbkRpYWdub3NpcyI6IFtdLCJwcm9jZWR1cmUiOiBbXSwic2Vjb25kYXJ5RGlhZ25vc2lzIjogW10sImJlZENsYXNzIjogW10sImxvc0dyb3VwIjogW10sImRpc2NoYXJnZUZyb20iOiAiMjAyMi0wOS0xOVQwNjowMDowMC4wMDBaIiwiZGlzY2hhcmdlVG8iOiAiMjAyMi0wOS0yNVQwNjowMDowMC4wMDBaIn0%3D",
  "https://datenbrowser.inek.org/DRG202210?q=eyJhZ2VHcm91cCI6IFtdLCJkZXB0IjogW10sImRyZyI6IFtdLCJmdXJ0aGVyUHJvY2VkdXJlIjogW10sImZ1cnRoZXJTZWNvbmRhcnlEaWFnbm9zaXMiOiBbXSwibWFpbkRpYWdub3NpcyI6IFtdLCJwcm9jZWR1cmUiOiBbXSwic2Vjb25kYXJ5RGlhZ25vc2lzIjogW10sImJlZENsYXNzIjogW10sImxvc0dyb3VwIjogW10sImRpc2NoYXJnZUZyb20iOiAiMjAyMi0wOS0yNlQwNjowMDowMC4wMDBaIiwiZGlzY2hhcmdlVG8iOiAiMjAyMi0xMC0wMlQwNjowMDowMC4wMDBaIn0%3D",
]

async function processUrl(page, url) {
  await page.goto(url)

  // Spinner
  await page.waitForSelector(
    'body > ngx-app > ngx-pages > ngx-one-column-layout > nb-layout > div > div > div > div > div > nb-layout-column > ngx-browser > div > div > nb-accordion > nb-accordion-item > nb-accordion-item-body > div > div > nb-card > nb-spinner > span',
    { hidden: true }
  )

  await page.click('#control-filterdata')

  await page.waitForSelector(
    'nb-card-body:nth-child(3)',
    { hidden: true }
  )

  await delay(60000)
  const button = await page.$('#control-excel');
  await button.click()

  await page.waitForSelector(
    '#control-excel > nb-spinner > span',
    { hidden: true }
  )
  await page.waitForTimeout(1000)
}

(async () => {
  const browser = await puppeteer.launch({
    headless: false,
    // executablePath: '/usr/bin/chromium-browser'
  })
  const page = await browser.newPage()
  const url = 'https://datenbrowser.inek.org/DRG202201'
  await page.setViewport({ width: 1366, height: 768 })
  await page.setDefaultTimeout(120000)
  await page.goto(url)

  await page.waitForSelector('nb-card-footer > button.float-right')
  await page.click('nb-card-footer > button.float-right')

  for (let i = 0; i < urls.length; i++) {
    const url = urls[i];
    console.log(`Processing ${i}, ${url}`)

    await processUrl(page, url)
    await page.waitForTimeout(10000)
  }

  await browser.close()
})()
