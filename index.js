const puppeteer = require('puppeteer')

function delay(time) {
  return new Promise(function (resolve) {
    setTimeout(resolve, time)
  });
}

const urls = [
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wMS0wMyIsImFkbWlzc2lvblRvIjoiMjAyMi0wMS0wOSJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wMS0xMCIsImFkbWlzc2lvblRvIjoiMjAyMi0wMS0xNiJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wMS0xNyIsImFkbWlzc2lvblRvIjoiMjAyMi0wMS0yMyJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wMS0yNCIsImFkbWlzc2lvblRvIjoiMjAyMi0wMS0zMCJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wMS0zMSIsImFkbWlzc2lvblRvIjoiMjAyMi0wMi0wNiJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wMi0wNyIsImFkbWlzc2lvblRvIjoiMjAyMi0wMi0xMyJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wMi0xNCIsImFkbWlzc2lvblRvIjoiMjAyMi0wMi0yMCJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wMi0yMSIsImFkbWlzc2lvblRvIjoiMjAyMi0wMi0yNyJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wMi0yOCIsImFkbWlzc2lvblRvIjoiMjAyMi0wMy0wNiJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wMy0wNyIsImFkbWlzc2lvblRvIjoiMjAyMi0wMy0xMyJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wMy0xNCIsImFkbWlzc2lvblRvIjoiMjAyMi0wMy0yMCJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wMy0yMSIsImFkbWlzc2lvblRvIjoiMjAyMi0wMy0yNyJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wMy0yOCIsImFkbWlzc2lvblRvIjoiMjAyMi0wNC0wMyJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wNC0wNCIsImFkbWlzc2lvblRvIjoiMjAyMi0wNC0xMCJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wNC0xMSIsImFkbWlzc2lvblRvIjoiMjAyMi0wNC0xNyJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wNC0xOCIsImFkbWlzc2lvblRvIjoiMjAyMi0wNC0yNCJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wNC0yNSIsImFkbWlzc2lvblRvIjoiMjAyMi0wNS0wMSJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wNS0wMiIsImFkbWlzc2lvblRvIjoiMjAyMi0wNS0wOCJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wNS0wOSIsImFkbWlzc2lvblRvIjoiMjAyMi0wNS0xNSJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wNS0xNiIsImFkbWlzc2lvblRvIjoiMjAyMi0wNS0yMiJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wNS0yMyIsImFkbWlzc2lvblRvIjoiMjAyMi0wNS0yOSJ9",
  "https://datenbrowser.inek.org/DRG202206?q=eyJhZ2VHcm91cCI6W10sImRyZyI6W10sImZ1cnRoZXJQcm9jZWR1cmUiOltdLCJmdXJ0aGVyU2Vjb25kYXJ5RGlhZ25vc2lzIjpbXSwibWFpbkRpYWdub3NpcyI6W10sInByb2NlZHVyZSI6W10sInNlY29uZGFyeURpYWdub3NpcyI6W10sImJlZENsYXNzIjpbXSwibG9zR3JvdXAiOltdLCJhZG1pc3Npb25Gcm9tIjoiMjAyMi0wNS0zMCIsImFkbWlzc2lvblRvIjoiMjAyMi0wNi0wNSJ9",
]

async function processUrl(page, url) {
  await page.goto(url)

  // Spinner
  await page.waitForSelector(
    'body > ngx-app > ngx-pages > ngx-one-column-layout > nb-layout > div > div > div > div > div > nb-layout-column > ngx-browser > div > div > nb-accordion > nb-accordion-item > nb-accordion-item-body > div > div > nb-card > nb-spinner > span',
    { hidden: true }
  )

  await page.click('#control-filterdata')

  await page.waitForSelector(
    'nb-card-body:nth-child(3)',
    { hidden: true }
  )

  const button = await page.$('#control-excel');
  await button.click()

  await page.waitForSelector(
    '#control-excel > nb-spinner > span',
    { hidden: true }
  )
  await page.waitForTimeout(1000)
}

(async () => {
  const browser = await puppeteer.launch({
    headless: false,
    // executablePath: '/usr/bin/chromium-browser'
  })
  const page = await browser.newPage()
  const url = 'https://datenbrowser.inek.org/DRG202201'
  await page.setViewport({ width: 1366, height: 768 })
  await page.setDefaultTimeout(120000)
  await page.goto(url)

  await page.waitForSelector('nb-card-footer > button.float-right')
  await page.click('nb-card-footer > button.float-right')

  for (let i = 0; i < urls.length; i++) {
    const url = urls[i];
    console.log(`Processing ${i}, ${url}`)

    await processUrl(page, url)
    await page.waitForTimeout(10000)
  }

  await browser.close()
})()
